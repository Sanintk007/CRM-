{% extends 'base.html' %}
{% load static %}
{% block title %}Reports | CRM{% endblock %}

{% block content %}
<div class="dashboard-container">
  <h2 class="page-title">Reports</h2>

  <div class="report-controls">
    <input type="text" id="searchInput" placeholder="Search by title..." onkeyup="filterTable()">
    <a href="{% url 'add_report' %}" class="btn-primary">+ Add Report</a>
  </div>

  {% if page_obj %}
  <table id="reportTable" class="styled-table">
    <thead>
      <tr>
        <th>#</th>
        <th>Title</th>
        <th>Details</th>
        <th>Created On</th>
      </tr>
    </thead>
    <tbody>
      {% for report in page_obj %}
      <tr>
        <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
        <td>{{ report.title }}</td>
        <td>{{ report.details|truncatechars:80 }}</td>
        <td>{{ report.created_at|date:"Y-m-d H:i" }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Pagination Controls -->
  <div class="pagination-container">
    <ul class="pagination">
      {% if page_obj.has_previous %}
        <li><a href="?page={{ page_obj.previous_page_number }}">« Prev</a></li>
      {% else %}
        <li class="disabled"><span>« Prev</span></li>
      {% endif %}

      {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
          <li class="active"><span>{{ num }}</span></li>
        {% else %}
          <li><a href="?page={{ num }}">{{ num }}</a></li>
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
        <li><a href="?page={{ page_obj.next_page_number }}">Next »</a></li>
      {% else %}
        <li class="disabled"><span>Next »</span></li>
      {% endif %}
    </ul>
  </div>

  {% else %}
    <p>No reports found.</p>
  {% endif %}
</div>

<script>
function filterTable() {
  let input = document.getElementById("searchInput");
  let filter = input.value.toLowerCase();
  let rows = document.querySelectorAll("#reportTable tbody tr");

  rows.forEach(row => {
    let title = row.cells[1].innerText.toLowerCase();
    row.style.display = title.includes(filter) ? "" : "none";
  });
}
</script>

<style>
.dashboard-container {
  background: #fff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
.page-title {
  font-size: 24px;
  margin-bottom: 16px;
  font-weight: 600;
}
.report-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}
#searchInput {
  width: 60%;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
}
.btn-primary {
  background: #007bff;
  color: white;
  padding: 8px 16px;
  border-radius: 6px;
  text-decoration: none;
  transition: 0.3s;
}
.btn-primary:hover {
  background: #0056b3;
}
.styled-table {
  width: 100%;
  border-collapse: collapse;
}
.styled-table th, .styled-table td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #eee;
}
.styled-table th {
  background: #007bff;
  color: white;
}
.styled-table tr:hover {
  background: #f5f5f5;
}

/* Pagination Styles */
.pagination-container {
  display: flex;
  justify-content: center;
  margin-top: 20px;
}
.pagination {
  list-style: none;
  display: flex;
  gap: 8px;
  padding: 0;
}
.pagination li {
  display: inline-block;
}
.pagination a, .pagination span {
  padding: 8px 12px;
  border-radius: 6px;
  text-decoration: none;
  border: 1px solid #007bff;
  color: #007bff;
  transition: 0.3s;
}
.pagination a:hover {
  background: #007bff;
  color: white;
}
.pagination .active span {
  background: #007bff;
  color: white;
  border: 1px solid #007bff;
}
.pagination .disabled span {
  color: #aaa;
  border: 1px solid #ddd;
}
</style>
{% endblock %}
